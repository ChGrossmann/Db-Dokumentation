<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Christoph Grossmann Löungen Prüfung 4. Semester</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>

    <body>

        <h1>Lösungen zur Prüfung 4.Semester Datenbanken</h1>

        <h3>Aufgabe 1</h3>
        <p> Analysieren Sie die Rechnung und bestimmen Sie mögliche Entitäten für ein Entity-Relationship-Modell.
        </p>
        <h4>Antwort 1.1</h4>

        <ul>

            <li>Rechnung
                <ul>
                    <li>id : serial pk</li>
                    <li>rechnugsnummer : numeric</li>
                    <li>id_lieferfirma : numeric fk</li>
                    <li>id_kunde : numeric fk</li>
                    <li>id_mwst : numeric fk</li>
                    <li>subtotal : numeric</li>
                    <li>mwstbetrag : numeric</li>
                    <li>preistotalinklmwst : numeric</li>
                    <li>bemerkungen : varchar(2000)</li>
                </ul>

            </li>
        </ul>
        <br>
        <ul>
            <li>Lieferfirma
                <ul>
                    <li>id : serial pk</li>
                    <li>firmenname : varchar(100)</li>
                    <li>id_adresse : numeric fk</li>
                    <li>telefonnummer : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>
            <li>Adresse
                <ul>
                    <li>id : serial pk</li>
                    <li>strasse : varchar(100)</li>
                    <li>strassennummer : numeric</li>
                    <li>ort : varchar(100)</li>
                    <li>plz : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>
            <li>Kunde
                <ul>
                    <li>id : serial pk</li>
                    <li>kundennummer : numeric</li>
                    <li>firmenname : varchar(100)</li>
                    <li>vormane : varchar(100)</li>
                    <li>nachname : varchar(100)</li>
                    <li>id_lieferfirma : varchar(100)</li>
                    <li>id_rechnungsadresse : varchar(100)</li>
                    <li>telefonnummer : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>
            <li>Artikel
                <ul>
                    <li>id : serial pk</li>
                    <li>artikelnummer : numeric</li>
                    <li>bezeichnung : varchar(100)</li>
                    <li>farbe : varchar(50)</li>
                    <li>grösse : varchar(50)</li>
                    <li>preis : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>
            <li>Rechnungsposition
                <ul>
                    <li>id : serial pk</li>
                    <li>id_rechnung : numeric fk</li>
                    <li>id_artikel : numeric fk</li>
                    <li>menge : numeric</li>
                    <li>preistotal : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>

            <li>Mehrwertsteuer
                <ul>
                    <li>id : serial pk</li>
                    <li>mwst : numeric</li>
                </ul>
            </li>
        </ul>

        <br>
        <h3>Aufgabe 2 - 10 Punkte</h3>
        <p> Erstellen Sie ein ERM zu Ihrer Lösung in Aufgabe 1.</p>
        <h4>Antwort 2.1</h4>
        <div><img src="/DB Pruefung 4.Semester Web/images/ER-Diagramm.jpg" width="1000" height="1000" alt="Bild wurde nicht gefunden"></div>

        <br>



        <h2>Aufgabe 3 - 30 Punkte</h2>
        <p>Folgende Klassen sind enthalten:</p>



        <h2>Antwort 3.1</h2>
        <h3>ch.teko.grossmac.db4.a3.dao  (DbConnection Code)</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">
            package ch.teko.grossmac.db4.a3.dao;

            import java.sql.Connection;
            import java.sql.DriverManager;
            import java.sql.SQLException;

            /**
            *
            * @author ch.grossmann
            */
            public class DBConnection {

            public static Connection connect() {

            Connection connection = null;

            try {
            Class.forName("org.postgresql.Driver");

            connection = DriverManager.getConnection(
            "jdbc:postgresql://localhost:5432/artikelliste", "postgres", "");
            System.out.println("Connected to the PostgreSQL server successfully.");

            } catch (ClassNotFoundException e) {
            System.out.println("PG Driver not found.");
            e.getMessage();
            } catch (SQLException e) {
            System.out.println("Connection failed! Check output of console.");
            e.getMessage();
            }

            if (connection != null) {
            System.out.println("Connection made to DB.");
            }

            return connection;
            }

            }
        </div>
        <h3>ch.teko.grossmac.db4.a3.dao   (ArtikelDao Code)</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">

            package ch.teko.grossmac.db4.a3.dao;

            import java.sql.Connection;
            import java.sql.ResultSet;
            import java.sql.SQLException;
            import java.sql.Statement;
            import java.util.ArrayList;
            import java.util.List;

            import ch.teko.grossmac.db4.a3.beans.Product;
            import java.sql.PreparedStatement;

            /**
            *
            * @author ch.grossmann
            */
            public class ProductDao {

            public List<Product> searchBezeichnungProducts(String searchString) {

            Product product;

            List<Product> products = new ArrayList<>();

            try {
            Connection connection = DBConnection.connect();

            String sql = "SELECT * FROM artikelliste WHERE bezeichnung LIKE "
            + "'%" + searchString + "%'";

            Statement statement = connection.createStatement();

            ResultSet set = statement.executeQuery(sql);


            while (set.next()) {
            product = new Product();
            product.setProductNumber(set.getString("artikelnummer"));
            product.setProductName(set.getString("bezeichnung"));
            product.setProductValue(set.getInt("menge"));
            product.setProductUnit(set.getString("einheit"));
            product.setProductPrice(set.getDouble("preis"));

            products.add(product);


            }

            set.close();
            statement.close();
            connection.close();


            } catch (SQLException ex) {
            System.out.println(ex.getMessage());
            }

            return products;

            }

            public List<Product> searchArtikelNrProducts(String searchString) {

            Product product;

            List<Product> products = new ArrayList<>();

            try {
            Connection connection = DBConnection.connect();

            String sql = "SELECT * FROM artikelliste WHERE artikelnummer LIKE "
            + "'%" +  searchString +"%'";

            Statement statement = connection.createStatement();

            ResultSet set = statement.executeQuery(sql);


            while (set.next()) {
            product = new Product();
            product.setProductNumber(set.getString("artikelnummer"));
            product.setProductName(set.getString("bezeichnung"));
            product.setProductValue(set.getInt("menge"));
            product.setProductUnit(set.getString("einheit"));
            product.setProductPrice(set.getDouble("preis"));

            products.add(product);


            }

            set.close();
            statement.close();
            connection.close();


            } catch (SQLException ex) {
            System.out.println(ex.getMessage());
            }

            return products;

            }

            public List<Product> newProductDao(String newNumber, String newName, String newValue, String newUnit, String newPrice) {

            Connection connection;
            Product product;
            List<Product> newProduct = new ArrayList<>();

            try {
            connection = DBConnection.connect();

            String sql = "INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) VALUES (?, ?, ?, ?, ?);";

            PreparedStatement statement = connection.prepareStatement(sql);
            statement.setString(1, newNumber);
            statement.setString(2, newName);
            statement.setInt(3, Integer.parseInt(newValue));
            statement.setString(4, newUnit.toUpperCase());
            statement.setDouble(5, Double.parseDouble(newPrice));

            statement.execute();

            statement.close(); 


            String sqlSelect = "SELECT * FROM artikelliste WHERE bezeichnung LIKE "
            + "'"  + newName + "';" ;

            Statement statementSelect = connection.createStatement();

            ResultSet setSelect = statementSelect.executeQuery(sqlSelect);

            while (setSelect.next()) {
            product = new Product();
            product.setProductNumber(setSelect.getString("artikelnummer"));
            product.setProductName(setSelect.getString("bezeichnung"));
            product.setProductValue(setSelect.getInt("menge"));
            product.setProductUnit(setSelect.getString("einheit"));
            product.setProductPrice(setSelect.getFloat("preis"));

            newProduct.add(product);
            }


            setSelect.close();
            statementSelect.close();

            connection.close();


            } catch (Exception ex) {
            System.out.println(ex.getMessage());
            }

            return newProduct;

            }

            }          

        </div>
        <h3>ch.teko.grossmac.db4.a3.beans  (Artikel Code)</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">

            package ch.teko.grossmac.db4.a3.beans;

            /**
            *
            * @author ch.grossmann
            */
            public class Product {

            private int productId;    
            private String productNumber;
            private String productName;
            private int productValue;
            private String productUnit;
            private double productPrice;

            public int getProductId() {
            return productId;
            }

            public void setProductId(int productId) {
            this.productId = productId;
            }

            public String getProductNumber() {
            return productNumber;
            }

            public void setProductNumber(String productNumber) {
            this.productNumber = productNumber;
            }

            public String getProductName() {
            return productName;
            }

            public void setProductName(String productName) {
            this.productName = productName;
            }

            public int getProductValue() {
            return productValue;
            }

            public void setProductValue(int productValue) {
            this.productValue = productValue;
            }

            public String getProductUnit() {
            return productUnit;
            }

            public void setProductUnit(String productUnit) {
            this.productUnit = productUnit;
            }

            public double getProductPrice() {
            return productPrice;
            }

            public void setProductPrice(double productPrice) {
            this.productPrice = productPrice;
            }


            }

        </div>


        <h3>package ch.teko.grossmac.db4.a3  (SearchProduct Code)</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">

            package ch.teko.grossmac.db4.a3;

            import java.io.IOException;
            import java.util.List;
            import javax.servlet.ServletException;
            import javax.servlet.http.HttpServlet;
            import javax.servlet.http.HttpServletRequest;
            import javax.servlet.http.HttpServletResponse;
            import ch.teko.grossmac.db4.a3.beans.Product;
            import ch.teko.grossmac.db4.a3.dao.ProductDao;

            /**
            *
            * @author ch.grossmann
            */
            public class SearchProduct extends HttpServlet {

            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

            // Formdaten übernehmen
            String searchString = req.getParameter("search");

            // DAO Layer aufrufen
            ProductDao dao = new ProductDao();
            List<Product> products = dao.searchBezeichnungProducts(searchString);

            // Daten an JSP Datei übergeben
            req.setAttribute("Products", products);
            req.getRequestDispatcher("index.jsp").forward(req, resp);

            }
            }
        </div>


        <h3>package ch.teko.grossmac.db4.a3  (SearchArtikelNrProduct Code)</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">

            package ch.teko.grossmac.db4.a3;

            import java.io.IOException;
            import java.util.List;
            import javax.servlet.ServletException;
            import javax.servlet.http.HttpServlet;
            import javax.servlet.http.HttpServletRequest;
            import javax.servlet.http.HttpServletResponse;
            import ch.teko.grossmac.db4.a3.beans.Product;
            import ch.teko.grossmac.db4.a3.dao.ProductDao;

            /**
            *
            * @author ch.grossmann
            */
            public class SearchArtikelNrProduct extends HttpServlet {

            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

            // Formdaten übernehmen
            String searchString = req.getParameter("searchArtikelNr");

            // DAO Layer aufrufen
            ProductDao dao = new ProductDao();
            List<Product> searchProducts = dao.searchArtikelNrProducts(searchString);

            // Daten an JSP Datei übergeben
            req.setAttribute("SearchProducts", searchProducts);
            req.getRequestDispatcher("showProduct.jsp").forward(req, resp);

            }
            }
        </div>


        <h3>package ch.teko.grossmac.db4.a3  (SearchBezeichnungProduct Code)</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">

            package ch.teko.grossmac.db4.a3;

            import java.io.IOException;
            import java.util.List;
            import javax.servlet.ServletException;
            import javax.servlet.http.HttpServlet;
            import javax.servlet.http.HttpServletRequest;
            import javax.servlet.http.HttpServletResponse;
            import ch.teko.grossmac.db4.a3.beans.Product;
            import ch.teko.grossmac.db4.a3.dao.ProductDao;

            /**
            *
            * @author ch.grossmann
            */
            public class SearchBezeichnungProduct extends HttpServlet {

            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

            // Formdaten übernehmen
            String searchString = req.getParameter("searchBezeichnung");

            // DAO Layer aufrufen
            ProductDao dao = new ProductDao();
            List<Product> products = dao.searchBezeichnungProducts(searchString);

            // Daten an JSP Datei übergeben
            req.setAttribute("SearchProducts", products);
            req.getRequestDispatcher("showProduct.jsp").forward(req, resp);

            }
            }
        </div>

        <h3>package ch.teko.grossmac.db.a3  (SQL zur Datenbank erstellung)</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">
            /**
            * Author:  ch.grossmann
            * Created: 26.05.2018
            */

            CREATE DATABASE artikelliste;


            CREATE TABLE artikelliste(
            id serial primary key,
            artikelnummer varchar(150),
            bezeichnung varchar(100),
            menge numeric,
            einheit varchar(100),
            preis numeric
            );
        </div>

        <h3>package ch.teko.grossmac.db.a3  (SQL zur Datenbank erstellung)</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">

            /* 
            * To change this license header, choose License Headers in Project Properties.
            * To change this template file, choose Tools | Templates
            * and open the template in the editor.
            */
            /**
            * Author:  ch.grossmann
            * Created: 16.06.2018
            */

            INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) 
            VALUES (32454, 'Kandelaber-Priemel', 4, 'STK', 3.6);

            INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) 
            VALUES (65677, 'Rose', 6, 'STK', 5.0);

            INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) 
            VALUES (98732, 'Tulpe', 9, 'STK', 1.5);

            INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) 
            VALUES (61987, 'Feilchen', 9, 'STK', 2);
        </div>

        <h3>Beschreibung der Lösung aus Anwendersicht</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">

            Auf der Startseite befindet man sich unter Artikel auflisten. Hier werden mit einem Klick auf den Suchen Button alle Artikel in der Datenbank aufgeliestet.
            Auf der linken Seite im Menü kann man auf die Seite Artikel suchen. Hier wird mit Hilfe der Artikelnummer oder der Bezeichung nach einen bestimmten Artikel gesucht.
            Unter Artikel erfassen kann man die verschiedenen Textfelder ausfüllen um so mit Hinzufügen einen neuen Artikel der Datenbank hinzuzufügen.

            (Auf der Startseite Artikel aufliesten kommt man wieder auf die Doku zurück.)

        </div>
        <h3>Link zum Code oder der lauffähigen Web-Site</h3>
        <a href="/Aufgabe3_Artikel">Aufgabe 3</a>
        <br><br>



        <!-- --------------------------------------------------------------------------- -->
        <h2>Aufgabe 4 - 50 Punkte (Diplomnote)</h2>
        <p>Diese Aufgabe ist ähnlich wie die Aufgabe 3, aber wir verwenden hier die
            Mongo Datenbank.
        </p>

        <p>
            Ziel dieser Aufgabe ist es eine kleine Web-Anwendung
            zu schreiben, die folgende Funktionen erfüllen soll:
        </p>
        <ul>
            <li>Rechnung erfasen</li>
            <li>Rechnung suchen</li>
            <li>Rechnung ändern</li>
            <li>Rechnung anzeigen</li>
        </ul>
        <p>
            Die Webseiten, die Sie für die Anwendung verwenden,können Sie gemäss Ihren Vorstellungen gestalten.
        </p>
        <h2>Antwort 4.1</h2>
        <h3>code</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">
        </div>
        <h3>weiterer Code</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">
        </div>
        <p>...</p>
        <h3>Beschreibung der Lösung aus Anwendersicht</h3>
        <div style="min-height: 100px; max-width: 500px; border-style: solid; border-width: 1pt">
        </div>
        <h3>Link zum Code oder der lauffähigen Web-Site</h3>
        <a href="#">Demo Aufgabe 4</a>
        <br><br>

        <strong>Hinweis:</strong> Die Notizen die zur Lösung dieser Aufgabe verwendet werden können, stehen ab dem 2. Juni 2018 zur Verfügung.



    </body>

</html>
