<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Christoph Grossmann Löungen Prüfung 4. Semester</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>

    <body>

        <h1>Lösungen zur Prüfung 4.Semester Datenbanken</h1>
        
        <div>
            <pre>
                Hier die Lösungen zu den Aufgaben der Diplomprüfung im Fach Datenbanken.
                Es hat mir grosse fruee bereitet die mir gestellten Aufgaben nach bestem Wissen und 
                Gewissen zu erfüllen. Vorallem Aufgabe 4 hat mich sehr gefordert, aber auch gefördert. 
                Falls Unklarheiten auftreten oder etwas nicht funktioniert melde dich Bitte umgehend.

                Ich entschuldige mich für das süäte abgeben der Arbeit. Durch iene lange Ferienabwesenheit 
                und diverse zeitintensive Piketteinsätze hat sich die fertigstellung verzögert.

                Bitte alle .war Dateien im Tomcat deployen.
                Aufgabe 3 - Bitte die benötigte SQL Db einrichten und Dummydaten einfügen, 
                Code dazu findest du unten.
                Aufgabe 4 - mongodb aktivieren. Bitte zuerst die Beschreibung unten durchlesen es gibt noch 
                einige verhaltenseisen die zu Fehlern führen können.
            </pre>
        </div>

        <h3>Aufgabe 1</h3>
        <p> Analysieren Sie die Rechnung und bestimmen Sie mögliche Entitäten für ein Entity-Relationship-Modell.
        </p>
        <h4>Antwort 1.1</h4>

        <ul>

            <li>Rechnung
                <ul>
                    <li>id : serial pk</li>
                    <li>rechnugsnummer : numeric</li>
                    <li>id_lieferfirma : numeric fk</li>
                    <li>id_kunde : numeric fk</li>
                    <li>id_mwst : numeric fk</li>
                    <li>subtotal : numeric</li>
                    <li>mwstbetrag : numeric</li>
                    <li>preistotalinklmwst : numeric</li>
                    <li>bemerkungen : varchar(2000)</li>
                </ul>

            </li>
        </ul>
        <br>
        <ul>
            <li>Lieferfirma
                <ul>
                    <li>id : serial pk</li>
                    <li>firmenname : varchar(100)</li>
                    <li>id_adresse : numeric fk</li>
                    <li>telefonnummer : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>
            <li>Adresse
                <ul>
                    <li>id : serial pk</li>
                    <li>strasse : varchar(100)</li>
                    <li>strassennummer : numeric</li>
                    <li>ort : varchar(100)</li>
                    <li>plz : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>
            <li>Kunde
                <ul>
                    <li>id : serial pk</li>
                    <li>kundennummer : numeric</li>
                    <li>firmenname : varchar(100)</li>
                    <li>vormane : varchar(100)</li>
                    <li>nachname : varchar(100)</li>
                    <li>id_lieferfirma : varchar(100)</li>
                    <li>id_rechnungsadresse : varchar(100)</li>
                    <li>telefonnummer : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>
            <li>Artikel
                <ul>
                    <li>id : serial pk</li>
                    <li>artikelnummer : numeric</li>
                    <li>bezeichnung : varchar(100)</li>
                    <li>farbe : varchar(50)</li>
                    <li>grösse : varchar(50)</li>
                    <li>preis : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>
            <li>Rechnungsposition
                <ul>
                    <li>id : serial pk</li>
                    <li>id_rechnung : numeric fk</li>
                    <li>id_artikel : numeric fk</li>
                    <li>menge : numeric</li>
                    <li>preistotal : numeric</li>
                </ul>
            </li>
        </ul>
        <br>
        <ul>

            <li>Mehrwertsteuer
                <ul>
                    <li>id : serial pk</li>
                    <li>mwst : numeric</li>
                </ul>
            </li>
        </ul>

        <br>
        <h3>Aufgabe 2 - 10 Punkte</h3>
        <p> Erstellen Sie ein ERM zu Ihrer Lösung in Aufgabe 1.</p>
        <h4>Antwort 2.1</h4>
        <div><img src="/DB Prüfung 4.Semester Web/web/images/ER-Diagramm.jpg" width="1000" height="1000" alt="Falls das Bild nicht angezeigt wird habe ich es im Zip abgelegt."></div>

        <br>



        <h2>Aufgabe 3 - 30 Punkte</h2>
        <p>Folgende Klassen sind enthalten:</p>



        <h2>Antwort 3.1</h2>
        <h3>ch.teko.grossmac.db4.a3.dao  (DbConnection Code)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            <pre>
            package ch.teko.grossmac.db4.a3.dao;

            import java.sql.Connection;
            import java.sql.DriverManager;
            import java.sql.SQLException;

            /**
            *
            * @author ch.grossmann
            */
            public class DBConnection {

            public static Connection connect() {

            Connection connection = null;

            try {
            Class.forName("org.postgresql.Driver");

            connection = DriverManager.getConnection(
            "jdbc:postgresql://localhost:5432/artikelliste", "postgres", "");
            System.out.println("Connected to the PostgreSQL server successfully.");

            } catch (ClassNotFoundException e) {
            System.out.println("PG Driver not found.");
            e.getMessage();
            } catch (SQLException e) {
            System.out.println("Connection failed! Check output of console.");
            e.getMessage();
            }

            if (connection != null) {
            System.out.println("Connection made to DB.");
            }

            return connection;
            }

            }
</pre>
        </div>
        <h3>ch.teko.grossmac.db4.a3.dao   (ArtikelDao Code)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
<pre>
            package ch.teko.grossmac.db4.a3.dao;

            import java.sql.Connection;
            import java.sql.ResultSet;
            import java.sql.SQLException;
            import java.sql.Statement;
            import java.util.ArrayList;
            import java.util.List;

            import ch.teko.grossmac.db4.a3.beans.Product;
            import java.sql.PreparedStatement;

            /**
            *
            * @author ch.grossmann
            */
            public class ProductDao {

            public List<Product> searchBezeichnungProducts(String searchString) {

            Product product;

            List<Product> products = new ArrayList<>();

            try {
            Connection connection = DBConnection.connect();

            String sql = "SELECT * FROM artikelliste WHERE bezeichnung LIKE "
            + "'%" + searchString + "%'";

            Statement statement = connection.createStatement();

            ResultSet set = statement.executeQuery(sql);


            while (set.next()) {
            product = new Product();
            product.setProductNumber(set.getString("artikelnummer"));
            product.setProductName(set.getString("bezeichnung"));
            product.setProductValue(set.getInt("menge"));
            product.setProductUnit(set.getString("einheit"));
            product.setProductPrice(set.getDouble("preis"));

            products.add(product);


            }

            set.close();
            statement.close();
            connection.close();


            } catch (SQLException ex) {
            System.out.println(ex.getMessage());
            }

            return products;

            }

            public List<Product> searchArtikelNrProducts(String searchString) {

            Product product;

            List<Product> products = new ArrayList<>();

            try {
            Connection connection = DBConnection.connect();

            String sql = "SELECT * FROM artikelliste WHERE artikelnummer LIKE "
            + "'%" +  searchString +"%'";

            Statement statement = connection.createStatement();

            ResultSet set = statement.executeQuery(sql);


            while (set.next()) {
            product = new Product();
            product.setProductNumber(set.getString("artikelnummer"));
            product.setProductName(set.getString("bezeichnung"));
            product.setProductValue(set.getInt("menge"));
            product.setProductUnit(set.getString("einheit"));
            product.setProductPrice(set.getDouble("preis"));

            products.add(product);


            }

            set.close();
            statement.close();
            connection.close();


            } catch (SQLException ex) {
            System.out.println(ex.getMessage());
            }

            return products;

            }

            public List<Product> newProductDao(String newNumber, String newName, String newValue, String newUnit, String newPrice) {

            Connection connection;
            Product product;
            List<Product> newProduct = new ArrayList<>();

            try {
            connection = DBConnection.connect();

            String sql = "INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) VALUES (?, ?, ?, ?, ?);";

            PreparedStatement statement = connection.prepareStatement(sql);
            statement.setString(1, newNumber);
            statement.setString(2, newName);
            statement.setInt(3, Integer.parseInt(newValue));
            statement.setString(4, newUnit.toUpperCase());
            statement.setDouble(5, Double.parseDouble(newPrice));

            statement.execute();

            statement.close(); 


            String sqlSelect = "SELECT * FROM artikelliste WHERE bezeichnung LIKE "
            + "'"  + newName + "';" ;

            Statement statementSelect = connection.createStatement();

            ResultSet setSelect = statementSelect.executeQuery(sqlSelect);

            while (setSelect.next()) {
            product = new Product();
            product.setProductNumber(setSelect.getString("artikelnummer"));
            product.setProductName(setSelect.getString("bezeichnung"));
            product.setProductValue(setSelect.getInt("menge"));
            product.setProductUnit(setSelect.getString("einheit"));
            product.setProductPrice(setSelect.getFloat("preis"));

            newProduct.add(product);
            }


            setSelect.close();
            statementSelect.close();

            connection.close();


            } catch (Exception ex) {
            System.out.println(ex.getMessage());
            }

            return newProduct;

            }

            }          
</pre>
        </div>
        <h3>ch.teko.grossmac.db4.a3.beans  (Artikel Code)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
<pre>
            package ch.teko.grossmac.db4.a3.beans;

            /**
            *
            * @author ch.grossmann
            */
            public class Product {

            private int productId;    
            private String productNumber;
            private String productName;
            private int productValue;
            private String productUnit;
            private double productPrice;

            public int getProductId() {
            return productId;
            }

            public void setProductId(int productId) {
            this.productId = productId;
            }

            public String getProductNumber() {
            return productNumber;
            }

            public void setProductNumber(String productNumber) {
            this.productNumber = productNumber;
            }

            public String getProductName() {
            return productName;
            }

            public void setProductName(String productName) {
            this.productName = productName;
            }

            public int getProductValue() {
            return productValue;
            }

            public void setProductValue(int productValue) {
            this.productValue = productValue;
            }

            public String getProductUnit() {
            return productUnit;
            }

            public void setProductUnit(String productUnit) {
            this.productUnit = productUnit;
            }

            public double getProductPrice() {
            return productPrice;
            }

            public void setProductPrice(double productPrice) {
            this.productPrice = productPrice;
            }


            }

      </pre>  </div>


        <h3>package ch.teko.grossmac.db4.a3  (SearchProduct Code)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
<pre>
            package ch.teko.grossmac.db4.a3;

            import java.io.IOException;
            import java.util.List;
            import javax.servlet.ServletException;
            import javax.servlet.http.HttpServlet;
            import javax.servlet.http.HttpServletRequest;
            import javax.servlet.http.HttpServletResponse;
            import ch.teko.grossmac.db4.a3.beans.Product;
            import ch.teko.grossmac.db4.a3.dao.ProductDao;

            /**
            *
            * @author ch.grossmann
            */
            public class SearchProduct extends HttpServlet {

            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

            // Formdaten übernehmen
            String searchString = req.getParameter("search");

            // DAO Layer aufrufen
            ProductDao dao = new ProductDao();
            List<Product> products = dao.searchBezeichnungProducts(searchString);

            // Daten an JSP Datei übergeben
            req.setAttribute("Products", products);
            req.getRequestDispatcher("index.jsp").forward(req, resp);

            }
            }
       </pre> </div>


        <h3>package ch.teko.grossmac.db4.a3  (SearchArtikelNrProduct Code)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
<pre>
            package ch.teko.grossmac.db4.a3;

            import java.io.IOException;
            import java.util.List;
            import javax.servlet.ServletException;
            import javax.servlet.http.HttpServlet;
            import javax.servlet.http.HttpServletRequest;
            import javax.servlet.http.HttpServletResponse;
            import ch.teko.grossmac.db4.a3.beans.Product;
            import ch.teko.grossmac.db4.a3.dao.ProductDao;

            /**
            *
            * @author ch.grossmann
            */
            public class SearchArtikelNrProduct extends HttpServlet {

            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

            // Formdaten übernehmen
            String searchString = req.getParameter("searchArtikelNr");

            // DAO Layer aufrufen
            ProductDao dao = new ProductDao();
            List<Product> searchProducts = dao.searchArtikelNrProducts(searchString);

            // Daten an JSP Datei übergeben
            req.setAttribute("SearchProducts", searchProducts);
            req.getRequestDispatcher("showProduct.jsp").forward(req, resp);

            }
            }
       </pre> </div>


        <h3>package ch.teko.grossmac.db4.a3  (SearchBezeichnungProduct Code)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
<pre>
            package ch.teko.grossmac.db4.a3;

            import java.io.IOException;
            import java.util.List;
            import javax.servlet.ServletException;
            import javax.servlet.http.HttpServlet;
            import javax.servlet.http.HttpServletRequest;
            import javax.servlet.http.HttpServletResponse;
            import ch.teko.grossmac.db4.a3.beans.Product;
            import ch.teko.grossmac.db4.a3.dao.ProductDao;

            /**
            *
            * @author ch.grossmann
            */
            public class SearchBezeichnungProduct extends HttpServlet {

            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

            // Formdaten übernehmen
            String searchString = req.getParameter("searchBezeichnung");

            // DAO Layer aufrufen
            ProductDao dao = new ProductDao();
            List<Product> products = dao.searchBezeichnungProducts(searchString);

            // Daten an JSP Datei übergeben
            req.setAttribute("SearchProducts", products);
            req.getRequestDispatcher("showProduct.jsp").forward(req, resp);

            }
            }
       </pre> </div>

        <h3>package ch.teko.grossmac.db.a3  (SQL zur Datenbank erstellung)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            <pre>
            /**
            * Author:  ch.grossmann
            * Created: 26.05.2018
            */

            CREATE DATABASE artikelliste;


            CREATE TABLE artikelliste(
            id serial primary key,
            artikelnummer varchar(150),
            bezeichnung varchar(100),
            menge numeric,
            einheit varchar(100),
            preis numeric
            );
       </pre> </div>

        <h3>package ch.teko.grossmac.db.a3  (SQL zur Datenbank erstellung)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
<pre>
            /* 
            * To change this license header, choose License Headers in Project Properties.
            * To change this template file, choose Tools | Templates
            * and open the template in the editor.
            */
            /**
            * Author:  ch.grossmann
            * Created: 16.06.2018
            */

            INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) 
            VALUES (32454, 'Kandelaber-Priemel', 4, 'STK', 3.6);

            INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) 
            VALUES (65677, 'Rose', 6, 'STK', 5.0);

            INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) 
            VALUES (98732, 'Tulpe', 9, 'STK', 1.5);

            INSERT INTO artikelliste (artikelnummer, bezeichnung, menge, einheit, preis) 
            VALUES (61987, 'Feilchen', 9, 'STK', 2);
       </pre> </div>

        <h3>Beschreibung der Lösung aus Anwendersicht</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
<pre>
            Auf der Startseite befindet man sich unter Artikel auflisten. Hier werden mit einem 
            Klick auf den Suchen Button alle Artikel in der Datenbank aufgeliestet.
            Auf der linken Seite im Menü kann man auf die Seite Artikel suchen. Hier wird mit 
            Hilfe der Artikelnummer oder der Bezeichung nach einen bestimmten Artikel gesucht.
            Unter Artikel erfassen kann man die verschiedenen Textfelder ausfüllen um so mit 
            Hinzufügen einen neuen Artikel der Datenbank hinzuzufügen.

            (Auf der Startseite Artikel aufliesten kommt man wieder auf die Doku zurück.)
            
           
</pre>
        </div>
        <h3>Link zum Code oder der lauffähigen Web-Site</h3>
        <a href="/Aufgabe3_Artikel">Aufgabe 3</a>
        <br><br>



        <!-- --------------------------------------------------------------------------- -->
        <h2>Aufgabe 4 - 50 Punkte (Diplomnote)</h2>
        
            <pre>Diese Aufgabe ist ähnlich wie die Aufgabe 3, aber wir verwenden hier die
            Mongo Datenbank.</pre>
        

        <pre>
            Ziel dieser Aufgabe ist es eine kleine Web-Anwendung
            zu schreiben, die folgende Funktionen erfüllen soll:
       </pre>
        <ul>
            <li>Rechnung erfasen</li>
            <li>Rechnung suchen</li>
            <li>Rechnung ändern</li>
            <li>Rechnung anzeigen</li>
        </ul>
        <pre>
            Die Webseiten, die Sie für die Anwendung verwenden,können Sie gemäss Ihren Vorstellungen gestalten.
        </pre>
        <h2>Antwort 4.1</h2>
        
        
        <h3>package ch.teko.grossmac.db4.a4.dao (DBConnection)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            <pre>
               package ch.teko.grossmac.db4.a4.dao;

import com.mongodb.client.MongoClient;
import com.mongodb.client.MongoClients;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import org.bson.Document;

/**
 * DBConnection erstellt die Verbindung zur DB.
 * @author ch.grossmann
 */
public class DBConnection {

    public MongoDatabase db;
    public MongoCollection<Document> mdbCollection;
    
    /**
     * connection erwartet ein Parameter für den Namen der Collection.
     * @param collection 
     */
       public void connection(String collection){
        // Verbindung zu localhost, Port: 27017
        MongoClient client = MongoClients.create();

       /**
        * Die Db rechnung
        */
        db = client.getDatabase("rechnung");
        
        /**
         * Die Collection nach Parameter
         */
        mdbCollection = db.getCollection(collection);

        

    }

} 
                
           </pre>
            
            
        </div>
        
        
        
        <h3>package ch.teko.grossmac.db4.a4.dao  (BillDao)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
               
                package ch.teko.grossmac.db4.a4.dao;

import ch.teko.grossmac.db4.a4.beans.Bill;
import com.mongodb.client.result.DeleteResult;
import java.util.ArrayList;

import java.util.GregorianCalendar;
import java.util.List;
import org.bson.Document;

/**
 * In der BillDao Klasse werden alle operationen mit der Datenbank gemacht.
 * 
 * createBill
 * updateBill
 * searchBill
 * searchBillNr
 * deleteBillNr
 * 
 * @author ch.grossmann
 */
public class BillDao {
    Bill billObject = new Bill();           
                        

    DBConnection conn = new DBConnection();
    
    
        /**
         * Mit createBill werden alle Daten erstellt um eine Rechnung zu erstellen.
         * @param rechnungsnummer
         * @param rechnung_firma
         * @param rechnung_name
         * @param rechnung_strasse
         * @param rechnung_plz
         * @param rechnung_ort
         * @param kunde_firma
         * @param kunde_name
         * @param kunde_strasse
         * @param kunde_plz
         * @param kunde_ort
         * @param liefer_firma
         * @param liefer_name
         * @param liefer_strasse
         * @param liefer_plz
         * @param liefer_ort
         * @param new_1_artikelnummer
         * @param new_1_bezeichnung
         * @param new_1_farbe
         * @param new_1_anzahl
         * @param new_1_einheit
         * @param new_1_preis
         * @param new_2_artikelnummer
         * @param new_2_bezeichnung
         * @param new_2_farbe
         * @param new_2_anzahl
         * @param new_2_einheit
         * @param new_2_preis
         * @param new_3_artikelnummer
         * @param new_3_bezeichnung
         * @param new_3_farbe
         * @param new_3_anzahl
         * @param new_3_einheit
         * @param new_3_preis
         * @param new_4_artikelnummer
         * @param new_4_bezeichnung
         * @param new_4_farbe
         * @param new_4_anzahl
         * @param new_4_einheit
         * @param new_4_preis
         * @param new_5_artikelnummer
         * @param new_5_bezeichnung
         * @param new_5_farbe
         * @param new_5_anzahl
         * @param new_5_einheit
         * @param new_5_preis
         * @param bemerkung
         * @return 
         */
        public Document createBill(
                int rechnungsnummer,
                
                String rechnung_firma, 
                String rechnung_name, 
                String rechnung_strasse, 
                int rechnung_plz, 
                String rechnung_ort, 
                
                String kunde_firma,
                String kunde_name, 
                String kunde_strasse, 
                int kunde_plz, 
                String kunde_ort, 
                
                String liefer_firma, 
                String liefer_name, 
                String liefer_strasse, 
                int liefer_plz, 
                String liefer_ort, 
                
                int new_1_artikelnummer, 
                String new_1_bezeichnung, 
                String new_1_farbe, 
                int new_1_anzahl, 
                String new_1_einheit, 
                double new_1_preis, 
                
                int new_2_artikelnummer, 
                String new_2_bezeichnung, 
                String new_2_farbe,
                int new_2_anzahl, 
                String new_2_einheit, 
                double new_2_preis, 
                
                int new_3_artikelnummer, 
                String new_3_bezeichnung, 
                String new_3_farbe, 
                int new_3_anzahl, 
                String new_3_einheit, 
                double new_3_preis,
                
                int new_4_artikelnummer, 
                String new_4_bezeichnung, 
                String new_4_farbe, 
                int new_4_anzahl, 
                String new_4_einheit, 
                double new_4_preis, 
                
                int new_5_artikelnummer, 
                String new_5_bezeichnung,
                String new_5_farbe, 
                int new_5_anzahl, 
                String new_5_einheit, 
                double new_5_preis, 
                
                String bemerkung){
            
           
        /**
         * Hier wird die Verbindung zur Colletion bill erstellt.
         */
        conn.connection("bill");
        
        /**
         * Hier werden alle Parameter zu einem Document zusammengeführt.
         */
        Document bill = new Document();
        bill.append("rechnungsnummer", rechnungsnummer);
        bill.append("datum", new GregorianCalendar().getTime());
        bill.append("mandant", erstelleMandant(rechnung_firma, 
                 rechnung_name, 
                 rechnung_strasse, 
                 rechnung_plz, 
                 rechnung_ort));
        bill.append("kunde", erstelleKunde( kunde_firma,
                 kunde_name, 
                 kunde_strasse, 
                 kunde_plz, 
                kunde_ort));
        bill.append("lieferadresse", erstelleLieferadresse( liefer_firma, 
                 liefer_name, 
                 liefer_strasse, 
                 liefer_plz, 
                 liefer_ort));
        bill.append("positionen", erstellePositionen( new_1_artikelnummer, 
                 new_1_bezeichnung, 
                 new_1_farbe, 
                 new_1_anzahl, 
                 new_1_einheit, 
                 new_1_preis, 
                
                 new_2_artikelnummer, 
                 new_2_bezeichnung, 
                 new_2_farbe,
                 new_2_anzahl, 
                 new_2_einheit, 
                 new_2_preis, 
                
                 new_3_artikelnummer, 
                 new_3_bezeichnung, 
                 new_3_farbe, 
                 new_3_anzahl, 
                 new_3_einheit, 
                 new_3_preis,
                
                 new_4_artikelnummer, 
                 new_4_bezeichnung, 
                 new_4_farbe, 
                 new_4_anzahl, 
                 new_4_einheit, 
                 new_4_preis, 
                
                 new_5_artikelnummer, 
                 new_5_bezeichnung,
                 new_5_farbe, 
                 new_5_anzahl, 
                 new_5_einheit, 
                 new_5_preis));
        

        bill.append("bemerkung", bemerkung);
        
        bill.append("mwstsatz", billObject.getMwst());
        bill.append("zahlungsbedingung", billObject.getZahlungsbedingung());
        bill.append("danke", billObject.getDanke());
        
        /**
         * Hier wird das vorbereitete Document in die Datenbank gespeichert.
        */
        conn.mdbCollection.insertOne(bill);
        
        return bill;

        
    }
        
        /**
         * Mit updateBill werden alle Daten erstellt um eine Rechnung zu ändern.
         * @param rechnungsnummer
         * @param rechnung_firma
         * @param rechnung_name
         * @param rechnung_strasse
         * @param rechnung_plz
         * @param rechnung_ort
         * @param kunde_firma
         * @param kunde_name
         * @param kunde_strasse
         * @param kunde_plz
         * @param kunde_ort
         * @param liefer_firma
         * @param liefer_name
         * @param liefer_strasse
         * @param liefer_plz
         * @param liefer_ort
         * @param new_1_artikelnummer
         * @param new_1_bezeichnung
         * @param new_1_farbe
         * @param new_1_anzahl
         * @param new_1_einheit
         * @param new_1_preis
         * @param new_2_artikelnummer
         * @param new_2_bezeichnung
         * @param new_2_farbe
         * @param new_2_anzahl
         * @param new_2_einheit
         * @param new_2_preis
         * @param new_3_artikelnummer
         * @param new_3_bezeichnung
         * @param new_3_farbe
         * @param new_3_anzahl
         * @param new_3_einheit
         * @param new_3_preis
         * @param new_4_artikelnummer
         * @param new_4_bezeichnung
         * @param new_4_farbe
         * @param new_4_anzahl
         * @param new_4_einheit
         * @param new_4_preis
         * @param new_5_artikelnummer
         * @param new_5_bezeichnung
         * @param new_5_farbe
         * @param new_5_anzahl
         * @param new_5_einheit
         * @param new_5_preis
         * @param bemerkung
         * @return 
         */
        public Document updateBill(
                int rechnungsnummerAlt,
                int rechnungsnummer,
                
                String rechnung_firma, 
                String rechnung_name, 
                String rechnung_strasse, 
                int rechnung_plz, 
                String rechnung_ort, 
                
                String kunde_firma,
                String kunde_name, 
                String kunde_strasse, 
                int kunde_plz, 
                String kunde_ort, 
                
                String liefer_firma, 
                String liefer_name, 
                String liefer_strasse, 
                int liefer_plz, 
                String liefer_ort, 
                
                int new_1_artikelnummer, 
                String new_1_bezeichnung, 
                String new_1_farbe, 
                int new_1_anzahl, 
                String new_1_einheit, 
                double new_1_preis, 
                
                int new_2_artikelnummer, 
                String new_2_bezeichnung, 
                String new_2_farbe,
                int new_2_anzahl, 
                String new_2_einheit, 
                double new_2_preis, 
                
                int new_3_artikelnummer, 
                String new_3_bezeichnung, 
                String new_3_farbe, 
                int new_3_anzahl, 
                String new_3_einheit, 
                double new_3_preis,
                
                int new_4_artikelnummer, 
                String new_4_bezeichnung, 
                String new_4_farbe, 
                int new_4_anzahl, 
                String new_4_einheit, 
                double new_4_preis, 
                
                int new_5_artikelnummer, 
                String new_5_bezeichnung,
                String new_5_farbe, 
                int new_5_anzahl, 
                String new_5_einheit, 
                double new_5_preis, 
                
                String bemerkung){
            
           
        /**
         * Hier wird die Verbindung zur Colletion bill erstellt.
         */
        conn.connection("bill");
        
        /**
         * Die Erstellung des filters für die Suche nach dem richtigen Eintrag.
         */
        Document filter = new Document();
        filter.append("rechnungsnummer", rechnungsnummerAlt);

        /**
         * Hier werden alle Parameter zu einem Document zusammengeführt.
         */
        Document billNew = new Document();
        billNew.append("rechnungsnummer", rechnungsnummer);
        billNew.append("datum", new GregorianCalendar().getTime());
        billNew.append("mandant", erstelleMandant(rechnung_firma, 
                 rechnung_name, 
                 rechnung_strasse, 
                 rechnung_plz, 
                 rechnung_ort));
        billNew.append("kunde", erstelleKunde( kunde_firma,
                 kunde_name, 
                 kunde_strasse, 
                 kunde_plz, 
                kunde_ort));
        billNew.append("lieferadresse", erstelleLieferadresse( liefer_firma, 
                 liefer_name, 
                 liefer_strasse, 
                 liefer_plz, 
                 liefer_ort));
        billNew.append("positionen", erstellePositionen( new_1_artikelnummer, 
                 new_1_bezeichnung, 
                 new_1_farbe, 
                 new_1_anzahl, 
                 new_1_einheit, 
                 new_1_preis, 
                
                 new_2_artikelnummer, 
                 new_2_bezeichnung, 
                 new_2_farbe,
                 new_2_anzahl, 
                 new_2_einheit, 
                 new_2_preis, 
                
                 new_3_artikelnummer, 
                 new_3_bezeichnung, 
                 new_3_farbe, 
                 new_3_anzahl, 
                 new_3_einheit, 
                 new_3_preis,
                
                 new_4_artikelnummer, 
                 new_4_bezeichnung, 
                 new_4_farbe, 
                 new_4_anzahl, 
                 new_4_einheit, 
                 new_4_preis, 
                
                 new_5_artikelnummer, 
                 new_5_bezeichnung,
                 new_5_farbe, 
                 new_5_anzahl, 
                 new_5_einheit, 
                 new_5_preis));
        

        billNew.append("bemerkung", bemerkung);
        
        billNew.append("mwstsatz", billObject.getMwst());
        billNew.append("zahlungsbedingung", billObject.getZahlungsbedingung());
        billNew.append("danke", billObject.getDanke());
        
        /**
         * 1. Parameter ist der filter und der 2. das einzusetzende dokument
         */
        conn.mdbCollection.findOneAndReplace(filter, billNew);
        
        return billNew;

        
    }

    /**
     * Hier wird ein Mandant erstellt für die Rechnung.
     * @param rechnung_firma
     * @param rechnung_name
     * @param rechnung_strasse
     * @param rechnung_plz
     * @param rechnung_ort
     * @return 
     */   
    private Document erstelleMandant(String rechnung_firma, 
                String rechnung_name, 
                String rechnung_strasse, 
                int rechnung_plz, 
                String rechnung_ort) {
        Document doc = new Document();
        doc.append("firmenname", rechnung_firma)
                .append("name", rechnung_name)
                .append("strasse", rechnung_strasse)
                .append("postleitzahl", rechnung_plz)
                .append("ort", rechnung_ort);

        return doc;
    }

    /**
     * Hier wird der Kunde erstellt für die Rechnung.
     * @param kunde_firma
     * @param kunde_name
     * @param kunde_strasse
     * @param kunde_plz
     * @param kunde_ort
     * @return 
     */
    private Document erstelleKunde(String kunde_firma,
                String kunde_name, 
                String kunde_strasse, 
                int kunde_plz, 
                String kunde_ort) {
        Document doc = new Document();
        doc.append("firmenname", kunde_firma)
                .append("name", kunde_name)
                .append("strasse", kunde_strasse)
                .append("postleitzahl", kunde_plz)
                .append("ort", kunde_ort);

        return doc;
    }

    /**
     * Hier wird die Lieferadresse für die Rechnung erstellt
     * @param liefer_firma
     * @param liefer_name
     * @param liefer_strasse
     * @param liefer_plz
     * @param liefer_ort
     * @return 
     */
    private Document erstelleLieferadresse(String liefer_firma, 
                String liefer_name, 
                String liefer_strasse, 
                int liefer_plz, 
                String liefer_ort) {
        Document doc = new Document();
        doc.append("firmenname", liefer_firma)
                .append("name", liefer_name)
                .append("strasse", liefer_strasse)
                .append("postleitzahl", liefer_plz)
                .append("ort", liefer_ort);
        return doc;
    }

    /**
     * Hier wird ein Artikel erstellt für die Rechnung
     * @param artikelNr
     * @param beschreibung
     * @param farbe
     * @param menge
     * @param einheit
     * @param einzelpreis
     * @return 
     */
    private Document erstelleArtikel(int artikelNr, String beschreibung, 
            String farbe, int menge, String einheit, double einzelpreis) {

        Document doc = new Document();
        doc.append("artikelNr", artikelNr)
                .append("bezeichnung", beschreibung)
                .append("farbe", beschreibung)
                .append("menge", menge)
                .append("einheit", einheit)
                .append("einzelpreis", einzelpreis);

        return doc;

    }

    /**
     * Hier werden alle 5 Positionen erstellt für die Rechnung.
     * @param new_1_artikelnummer
     * @param new_1_bezeichnung
     * @param new_1_farbe
     * @param new_1_anzahl
     * @param new_1_einheit
     * @param new_1_preis
     * @param new_2_artikelnummer
     * @param new_2_bezeichnung
     * @param new_2_farbe
     * @param new_2_anzahl
     * @param new_2_einheit
     * @param new_2_preis
     * @param new_3_artikelnummer
     * @param new_3_bezeichnung
     * @param new_3_farbe
     * @param new_3_anzahl
     * @param new_3_einheit
     * @param new_3_preis
     * @param new_4_artikelnummer
     * @param new_4_bezeichnung
     * @param new_4_farbe
     * @param new_4_anzahl
     * @param new_4_einheit
     * @param new_4_preis
     * @param new_5_artikelnummer
     * @param new_5_bezeichnung
     * @param new_5_farbe
     * @param new_5_anzahl
     * @param new_5_einheit
     * @param new_5_preis
     * @return 
     */
    private ArrayList<Document> erstellePositionen(int new_1_artikelnummer, 
                String new_1_bezeichnung, 
                String new_1_farbe, 
                int new_1_anzahl, 
                String new_1_einheit, 
                double new_1_preis, 
                
                int new_2_artikelnummer, 
                String new_2_bezeichnung, 
                String new_2_farbe,
                int new_2_anzahl, 
                String new_2_einheit, 
                double new_2_preis, 
                
                int new_3_artikelnummer, 
                String new_3_bezeichnung, 
                String new_3_farbe, 
                int new_3_anzahl, 
                String new_3_einheit, 
                double new_3_preis,
                
                int new_4_artikelnummer, 
                String new_4_bezeichnung, 
                String new_4_farbe, 
                int new_4_anzahl, 
                String new_4_einheit, 
                double new_4_preis, 
                
                int new_5_artikelnummer, 
                String new_5_bezeichnung,
                String new_5_farbe, 
                int new_5_anzahl, 
                String new_5_einheit, 
                double new_5_preis) {

        /**
         * Die Positionen werden in eine ArrayList abgefüllt.
         */
        ArrayList<Document> positionen = new ArrayList<>();
        positionen.add(erstelleArtikel(new_1_artikelnummer, new_1_bezeichnung, new_1_farbe, 
        new_1_anzahl, new_1_einheit, new_1_preis));
        positionen.add(erstelleArtikel(new_2_artikelnummer, new_2_bezeichnung, new_2_farbe, 
        new_2_anzahl, new_2_einheit, new_2_preis));
        positionen.add(erstelleArtikel(new_3_artikelnummer, new_3_bezeichnung, new_3_farbe, 
        new_3_anzahl, new_3_einheit, new_3_preis));
        positionen.add(erstelleArtikel(new_4_artikelnummer, new_4_bezeichnung, new_4_farbe, 
        new_4_anzahl, new_4_einheit, new_4_preis));
        positionen.add(erstelleArtikel(new_5_artikelnummer, new_5_bezeichnung, new_5_farbe, 
        new_5_anzahl, new_5_einheit, new_5_preis));
        

        return positionen;
    }
    
   /**
    * Die Methode um alle(20) Rechnungen aud der Datenbank zu lesen und in eine ArrayList zu schreiben.
    * @return 
    */
   public List<Document> searchBill(){
       
       conn.connection("bill");
       
       
       List<Document> listBill = conn.mdbCollection.find().into(new ArrayList<Document>());
       
       
       return listBill;
   }
   
   /**
    * Die Methode um nach einer Rechnungsnummer zu suchen.
    * @param billNr
    * @return 
    */
   public List<Document> searchBillNr(int billNr){
       
       conn.connection("bill");
       
       Document filter = new Document("rechnungsnummer", billNr);
       
       List<Document> bill = conn.mdbCollection.find(filter).into(new ArrayList<Document>());
       
       
       return bill;
   }
   
   /**
    * Die Methode um einen Eintrag zu löschen.
    * @param billNr
    * @return 
    */
   public Document deleteBillNr(int billNr){
       
       conn.connection("bill");
       
       Document filter = new Document("rechnungsnummer", billNr);
       
      DeleteResult bill = conn.mdbCollection.deleteOne(filter);
       
      Document delCount = new Document ("delCount", bill.getDeletedCount());
       
       return delCount;
   }
    
    
}
                
            </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4.beans (Bill)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
               
                package ch.teko.grossmac.db4.a4.beans;

import java.util.Date;
import java.util.List;
import org.bson.Document;

/**
 * Die Bill Klasse wird als Bean verwendet für die Rechung.
 * @author ch.grossmann
 */
public class Bill {

       
    private int number;
    private Date date;
    private Document mandant;
    private Document customer;
    private Document address;
    private double priceTotal;
    private String comment;
    private double mwst = 7.7;
    private String zahlungsbedingung = "Zahlbar innert 30 Tagen.";
    private String danke = "Vielen Dank für die Bestellung";

    private List<Product> positionen;

    public Bill() {
    }

    public Bill(int number, Date date, Document mandant, Document customer, 
            Document address, double priceTotal, String comment, double mwst, 
            String zahlungsbedingung, String danke, List<Product> positionen) {
        this.number = number;
        this.date = date;
        this.mandant = mandant;
        this.customer = customer;
        this.address = address;
        this.priceTotal = priceTotal;
        this.comment = comment;
        this.mwst = mwst;
        this.zahlungsbedingung = zahlungsbedingung;
        this.danke = danke;
        this.positionen = positionen;
    }

    public int getNumber() {
        return number;
    }

    public void setNumber(int number) {
        this.number = number;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    public Document getMandant() {
        return mandant;
    }

    public void setMandant(Document mandant) {
        this.mandant = mandant;
    }

    public Document getCustomer() {
        return customer;
    }

    public void setCustomer(Document customer) {
        this.customer = customer;
    }

    public Document getAddress() {
        return address;
    }

    public void setAddress(Document address) {
        this.address = address;
    }

    public double getPriceTotal() {
        return priceTotal;
    }

    public void setPriceTotal(double priceTotal) {
        this.priceTotal = priceTotal;
    }

    public String getComment() {
        return comment;
    }

    public void setComment(String comment) {
        this.comment = comment;
    }

    public double getMwst() {
        return mwst;
    }

    public void setMwst(double mwst) {
        this.mwst = mwst;
    }

    public String getZahlungsbedingung() {
        return zahlungsbedingung;
    }

    public void setZahlungsbedingung(String zahlungsbedingung) {
        this.zahlungsbedingung = zahlungsbedingung;
    }

    public String getDanke() {
        return danke;
    }

    public void setDanke(String danke) {
        this.danke = danke;
    }

    public List<Product> getPositionen() {
        return positionen;
    }

    public void setPositionen(List<Product> positionen) {
        this.positionen = positionen;
    }

    
    



}
                
            </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4.beans (Product)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
               
                package ch.teko.grossmac.db4.a4.beans;

/**
 * Die Product Klasse wird als Bean für die Artikel verwendet.
 * @author ch.grossmann
 */
public class Product {
    
    private int artikelNr;
    private String bezeichung;
    private String farbe;
    private int anzahl;
    private String einheit;
    private double preis;

    public Product() {
    }

    public Product(int artikelNr, String bezeichung, String farbe, int anzahl, String einheit, double preis) {
        this.artikelNr = artikelNr;
        this.bezeichung = bezeichung;
        this.farbe = farbe;
        this.anzahl = anzahl;
        this.einheit = einheit;
        this.preis = preis;
    }

    public int getArtikelNr() {
        return artikelNr;
    }

    public void setArtikelNr(int artikelNr) {
        this.artikelNr = artikelNr;
    }

    public String getBezeichung() {
        return bezeichung;
    }

    public void setBezeichung(String bezeichung) {
        this.bezeichung = bezeichung;
    }

    public String getFarbe() {
        return farbe;
    }

    public void setFarbe(String farbe) {
        this.farbe = farbe;
    }

    public int getAnzahl() {
        return anzahl;
    }

    public void setAnzahl(int anzahl) {
        this.anzahl = anzahl;
    }

    public String getEinheit() {
        return einheit;
    }

    public void setEinheit(String einheit) {
        this.einheit = einheit;
    }

    public double getPreis() {
        return preis;
    }

    public void setPreis(double preis) {
        this.preis = preis;
    }
    
    
}
                
            </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4 (NewBill)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
                
                package ch.teko.grossmac.db4.a4;

import ch.teko.grossmac.db4.a4.beans.Bill;
import ch.teko.grossmac.db4.a4.dao.BillDao;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.bson.Document;

/**
 * In NewBill werden die Parameter der Website abgefangen und weiter geschickt
 * via dao.createBill.
 * Das Document newbill wir mit Hilfe von documentToBill umgewandelt.
 *
 * @author ch.grossmann
 */
public class NewBill extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        // Formdaten übernehmen
        //Rechnungsnummer
        int rechnungsnummer = Integer.parseInt(request.getParameter("rechnungsnummer"));

        //Rechnugsadresse
        String rechnung_firma = request.getParameter("rechnung_firma");
        String rechnung_name = request.getParameter("rechnung_name");
        String rechnung_strasse = request.getParameter("rechnung_strasse");
        int rechnung_plz = Integer.parseInt(request.getParameter("rechnung_plz"));
        String rechnung_ort = request.getParameter("rechnung_ort");

        //Kunde
        String kunde_firma = request.getParameter("kunde_firma");
        String kunde_name = request.getParameter("kunde_name");
        String kunde_strasse = request.getParameter("kunde_strasse");
        int kunde_plz = Integer.parseInt(request.getParameter("kunde_plz"));
        String kunde_ort = request.getParameter("kunde_ort");

        //Lieferadresse
        String liefer_firma = request.getParameter("liefer_firma");
        String liefer_name = request.getParameter("liefer_name");
        String liefer_strasse = request.getParameter("liefer_strasse");
        int liefer_plz = Integer.parseInt(request.getParameter("liefer_plz"));
        String liefer_ort = request.getParameter("liefer_ort");

        //Position 1
        int new_1_artikelnummer = Integer.parseInt(request.getParameter("1_artikelnummer"));
        String new_1_bezeichnung = request.getParameter("1_bezeichnung");
        String new_1_farbe = request.getParameter("1_farbe");
        int new_1_anzahl = Integer.parseInt(request.getParameter("1_anzahl"));
        String new_1_einheit = request.getParameter("1_einheit");
        double new_1_preis = Double.parseDouble(request.getParameter("1_preis"));

        //Position 2
        int new_2_artikelnummer = Integer.parseInt(request.getParameter("2_artikelnummer"));
        String new_2_bezeichnung = request.getParameter("2_bezeichnung");
        String new_2_farbe = request.getParameter("2_farbe");
        int new_2_anzahl = Integer.parseInt(request.getParameter("2_anzahl"));
        String new_2_einheit = request.getParameter("2_einheit");
        double new_2_preis = Double.parseDouble(request.getParameter("2_preis"));

        //Position 3
        int new_3_artikelnummer = Integer.parseInt(request.getParameter("3_artikelnummer"));
        String new_3_bezeichnung = request.getParameter("3_bezeichnung");
        String new_3_farbe = request.getParameter("3_farbe");
        int new_3_anzahl = Integer.parseInt(request.getParameter("3_anzahl"));
        String new_3_einheit = request.getParameter("3_einheit");
        double new_3_preis = Double.parseDouble(request.getParameter("3_preis"));

        //Position 4
        int new_4_artikelnummer = Integer.parseInt(request.getParameter("4_artikelnummer"));
        String new_4_bezeichnung = request.getParameter("4_bezeichnung");
        String new_4_farbe = request.getParameter("4_farbe");
        int new_4_anzahl = Integer.parseInt(request.getParameter("4_anzahl"));
        String new_4_einheit = request.getParameter("4_einheit");
        double new_4_preis = Double.parseDouble(request.getParameter("4_preis"));

        //Position 5
        int new_5_artikelnummer = Integer.parseInt(request.getParameter("5_artikelnummer"));
        String new_5_bezeichnung = request.getParameter("5_bezeichnung");
        String new_5_farbe = request.getParameter("5_farbe");
        int new_5_anzahl = Integer.parseInt(request.getParameter("5_anzahl"));
        String new_5_einheit = request.getParameter("5_einheit");
        double new_5_preis = Double.parseDouble(request.getParameter("5_preis"));

        //Bemerkung
        String bemerkung = request.getParameter("bemerkung");

        /**
         * Übergabe an das Dao
         */
        BillDao dao = new BillDao();
        Document newBill = dao.createBill(rechnungsnummer, rechnung_firma, rechnung_name, 
                rechnung_strasse, rechnung_plz, rechnung_ort, kunde_firma,
                kunde_name, kunde_strasse, kunde_plz, kunde_ort, liefer_firma, liefer_name, 
                liefer_strasse, liefer_plz, liefer_ort, new_1_artikelnummer,
                new_1_bezeichnung, new_1_farbe, new_1_anzahl, new_1_einheit, new_1_preis, 
                new_2_artikelnummer, new_2_bezeichnung, new_2_farbe,
                new_2_anzahl, new_2_einheit, new_2_preis, new_3_artikelnummer, new_3_bezeichnung, 
                new_3_farbe, new_3_anzahl, new_3_einheit, new_3_preis,
                new_4_artikelnummer, new_4_bezeichnung, new_4_farbe, new_4_anzahl, new_4_einheit, 
                new_4_preis, new_5_artikelnummer, new_5_bezeichnung,
                new_5_farbe, new_5_anzahl, new_5_einheit, new_5_preis, bemerkung);

        
       /**
        * Umwandlung vom Document zum Bill
        */
       DocumentToBill dtb = new DocumentToBill();
       Bill bill = dtb.documentToBill(newBill);
       
       

        
        

        // Daten an JSP Datei übergeben
        request.setAttribute("Bill", bill);
        request.getRequestDispatcher("showBill.jsp").forward(request, response);

    }
}
                
            </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4 (SearchBill)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
                
                package ch.teko.grossmac.db4.a4;

import ch.teko.grossmac.db4.a4.beans.Bill;
import ch.teko.grossmac.db4.a4.dao.BillDao;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.bson.Document;

/**
 * In der Klasse SearchBill wird die ausgelesene Liste aller Rechnungen
 * weitergegeben.
 *
 * @author ch.grossmann
 */
public class SearchBill extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        /**
         * Hier wird nach dem Rechnungen gesucht.
         */
        BillDao dao = new BillDao();
        List<Document> bills = dao.searchBill();

        ArrayList<Bill> listBill = new ArrayList<>();

        for (Document d : bills) {

            /**
             * Das Document wird in ein Bill umgewandelt.
             */
            DocumentToBill dtb = new DocumentToBill();
            Bill bill = dtb.documentToBill(d);

            listBill.add(bill);
        }

        request.setAttribute("ListBill", listBill);
        request.getRequestDispatcher("listBill.jsp").forward(request, response);

    }
}
                
            </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4 (ShowBill2)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
                
                package ch.teko.grossmac.db4.a4;

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
import ch.teko.grossmac.db4.a4.beans.Bill;
import ch.teko.grossmac.db4.a4.dao.BillDao;
import java.io.IOException;
import java.util.List;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.bson.Document;

/**
 * In der ShowBill Klasse wird die Anzeigen funktion gemacht. Durch den
 * Parameter billNr wird die Suche nach der bestimmten Rechnungsnummer in der
 * Datenbank gemacht.
 *
 * @author ch.grossmann
 */
public class ShowBill2 extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        
        /**
         * Rechnungsnummer aus dem Parameter.
         */
        int billNr = Integer.parseInt(request.getParameter("billNr"));
        
        /**
         * Hier wird nach der Rechnungsnummer gesucht.
         */
        BillDao billDao = new BillDao();
        DocumentToBill dtb = new DocumentToBill();
        List<Document> listBill = billDao.searchBillNr(billNr);

        Bill bill = dtb.documentToBill(listBill.get(0));

        // Daten an JSP Datei übergeben
        request.setAttribute("Bill", bill);
        request.getRequestDispatcher("showBill.jsp").forward(request, response);

    }
}
                
            </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4 (UpdateBill)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
                
                package ch.teko.grossmac.db4.a4;

import ch.teko.grossmac.db4.a4.beans.Bill;
import ch.teko.grossmac.db4.a4.dao.BillDao;
import java.io.IOException;
import java.util.List;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.bson.Document;

/**
 *In der UpdateBill Klasse wird durch den Parameter einer Rechnungsnummer diese gesucht um sie dann zu aktuallisieren.
 * @author ch.grossmann
 */
public class UpdateBill extends HttpServlet {

    
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        
        /**
         * Rechnungsnummer Parameter
         */
        int billNr = Integer.parseInt(request.getParameter("billNr"));

        /**
         * Hier wird nach der Rechnung gesucht.
         */
        BillDao billDao = new BillDao();
        DocumentToBill dtb = new DocumentToBill();
        List<Document> listBill = billDao.searchBillNr(billNr);

        Bill bill = dtb.documentToBill(listBill.get(0));

        // Daten an JSP Datei übergeben
        request.setAttribute("Bill", bill);
        request.getRequestDispatcher("updateBill.jsp").forward(request, response);
        
       }

        }
                
            </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4 (SaveUpdateBill)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
                
                package ch.teko.grossmac.db4.a4;

import ch.teko.grossmac.db4.a4.beans.Bill;
import ch.teko.grossmac.db4.a4.dao.BillDao;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.bson.Document;

/**
 *
 * @author ch.grossmann
 */
public class SaveUpdateBill extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        // Formdaten übernehmen
        //Rechnungsnummer
        int rechnungsnummerAlt = Integer.parseInt(request.getParameter("rechnungsnummer"));
        int rechnungsnummer = Integer.parseInt(request.getParameter("rechnungsnummer"));

        //Rechnugsadresse
        String rechnung_firma = request.getParameter("rechnung_firma");
        String rechnung_name = request.getParameter("rechnung_name");
        String rechnung_strasse = request.getParameter("rechnung_strasse");
        int rechnung_plz = Integer.parseInt(request.getParameter("rechnung_plz"));
        String rechnung_ort = request.getParameter("rechnung_ort");

        //Kunde
        String kunde_firma = request.getParameter("kunde_firma");
        String kunde_name = request.getParameter("kunde_name");
        String kunde_strasse = request.getParameter("kunde_strasse");
        int kunde_plz = Integer.parseInt(request.getParameter("kunde_plz"));
        String kunde_ort = request.getParameter("kunde_ort");

        //Lieferadresse
        String liefer_firma = request.getParameter("liefer_firma");
        String liefer_name = request.getParameter("liefer_name");
        String liefer_strasse = request.getParameter("liefer_strasse");
        int liefer_plz = Integer.parseInt(request.getParameter("liefer_plz"));
        String liefer_ort = request.getParameter("liefer_ort");

        //Position 1
        int new_1_artikelnummer = Integer.parseInt(request.getParameter("1_artikelnummer"));
        String new_1_bezeichnung = request.getParameter("1_bezeichnung");
        String new_1_farbe = request.getParameter("1_farbe");
        int new_1_anzahl = Integer.parseInt(request.getParameter("1_anzahl"));
        String new_1_einheit = request.getParameter("1_einheit");
        double new_1_preis = Double.parseDouble(request.getParameter("1_preis"));

        //Position 2
        int new_2_artikelnummer = Integer.parseInt(request.getParameter("2_artikelnummer"));
        String new_2_bezeichnung = request.getParameter("2_bezeichnung");
        String new_2_farbe = request.getParameter("2_farbe");
        int new_2_anzahl = Integer.parseInt(request.getParameter("2_anzahl"));
        String new_2_einheit = request.getParameter("2_einheit");
        double new_2_preis = Double.parseDouble(request.getParameter("2_preis"));

        //Position 3
        int new_3_artikelnummer = Integer.parseInt(request.getParameter("3_artikelnummer"));
        String new_3_bezeichnung = request.getParameter("3_bezeichnung");
        String new_3_farbe = request.getParameter("3_farbe");
        int new_3_anzahl = Integer.parseInt(request.getParameter("3_anzahl"));
        String new_3_einheit = request.getParameter("3_einheit");
        double new_3_preis = Double.parseDouble(request.getParameter("3_preis"));

        //Position 4
        int new_4_artikelnummer = Integer.parseInt(request.getParameter("4_artikelnummer"));
        String new_4_bezeichnung = request.getParameter("4_bezeichnung");
        String new_4_farbe = request.getParameter("4_farbe");
        int new_4_anzahl = Integer.parseInt(request.getParameter("4_anzahl"));
        String new_4_einheit = request.getParameter("4_einheit");
        double new_4_preis = Double.parseDouble(request.getParameter("4_preis"));

        //Position 5
        int new_5_artikelnummer = Integer.parseInt(request.getParameter("5_artikelnummer"));
        String new_5_bezeichnung = request.getParameter("5_bezeichnung");
        String new_5_farbe = request.getParameter("5_farbe");
        int new_5_anzahl = Integer.parseInt(request.getParameter("5_anzahl"));
        String new_5_einheit = request.getParameter("5_einheit");
        double new_5_preis = Double.parseDouble(request.getParameter("5_preis"));

        //Bemerkung
        String bemerkung = request.getParameter("bemerkung");

        // DAO Layer aufrufen
        BillDao dao = new BillDao();
        Document updatedBill = dao.updateBill(rechnungsnummerAlt, rechnungsnummer, rechnung_firma, 
                rechnung_name, rechnung_strasse, rechnung_plz, rechnung_ort, kunde_firma,
                kunde_name, kunde_strasse, kunde_plz, kunde_ort, liefer_firma, liefer_name, 
                liefer_strasse, liefer_plz, liefer_ort, new_1_artikelnummer,
                new_1_bezeichnung, new_1_farbe, new_1_anzahl, new_1_einheit, new_1_preis, 
                new_2_artikelnummer, new_2_bezeichnung, new_2_farbe,
                new_2_anzahl, new_2_einheit, new_2_preis, new_3_artikelnummer, new_3_bezeichnung, 
                new_3_farbe, new_3_anzahl, new_3_einheit, new_3_preis,
                new_4_artikelnummer, new_4_bezeichnung, new_4_farbe, new_4_anzahl, new_4_einheit, 
                new_4_preis, new_5_artikelnummer, new_5_bezeichnung,
                new_5_farbe, new_5_anzahl, new_5_einheit, new_5_preis, bemerkung);

        
       
       DocumentToBill dtb = new DocumentToBill();
       Bill bill = dtb.documentToBill(updatedBill);
       
       

        
        

        // Daten an JSP Datei übergeben
        request.setAttribute("Bill", bill);
        request.getRequestDispatcher("showBill.jsp").forward(request, response);

    }
    
}
                
          </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4 (DocumentToBill</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
          <pre>
                
                package ch.teko.grossmac.db4.a4;

import ch.teko.grossmac.db4.a4.beans.Bill;
import ch.teko.grossmac.db4.a4.beans.Product;
import java.util.ArrayList;
import org.bson.Document;

/**
 *DocumentToBill übernimmt die Umwandlung einer Rechnung aus der DB vom Document zum Bill
 * @author ch.grossmann
 */
public class DocumentToBill {
    
    public Bill documentToBill(Document doc){
    //Bean Bill abfüllen
        Bill bill = new Bill();

        bill.setNumber(doc.getInteger("rechnungsnummer"));

        bill.setDate(doc.getDate("datum"));

        Document mandant = (Document) doc.get("mandant");
        bill.setMandant(mandant);

        Document kunde = (Document) doc.get("kunde");
        bill.setCustomer(kunde);

        Document lieferadresse = (Document) doc.get("lieferadresse");
        bill.setAddress(lieferadresse);

        ArrayList<Document> positionen = (ArrayList<Document>) doc.get("positionen");

        Document price0 = positionen.get(0);
        double total0 = price0.getInteger("menge") * price0.getDouble("einzelpreis");
        Document price1 = positionen.get(1);
        double total1 = price1.getInteger("menge") * price1.getDouble("einzelpreis");
        Document price2 = positionen.get(2);
        double total2 = price2.getInteger("menge") * price2.getDouble("einzelpreis");
        Document price3 = positionen.get(3);
        double total3 = price3.getInteger("menge") * price3.getDouble("einzelpreis");
        Document price4 = positionen.get(4);
        double total4 = price4.getInteger("menge") * price4.getDouble("einzelpreis");
        double priceTotal = total0 + total1 + total2 + total3 + total4;
        bill.setPriceTotal(priceTotal);

        bill.setComment(doc.get("bemerkung").toString());

        bill.setMwst(doc.getDouble("mwstsatz"));
        bill.setZahlungsbedingung(doc.get("zahlungsbedingung").toString());
        bill.setDanke(doc.get("danke").toString());

        Product position0 = new Product();
        Document docPosition0 = price0;
        position0.setArtikelNr(docPosition0.getInteger("artikelNr"));
        position0.setBezeichung(docPosition0.get("bezeichnung").toString());
        position0.setFarbe(docPosition0.get("farbe").toString());
        position0.setAnzahl(docPosition0.getInteger("menge"));
        position0.setEinheit(docPosition0.get("einheit").toString());
        position0.setPreis(docPosition0.getDouble("einzelpreis"));

        Product position1 = new Product();
        Document docPosition1 = price1;
        position1.setArtikelNr(docPosition1.getInteger("artikelNr"));
        position1.setBezeichung(docPosition1.get("bezeichnung").toString());
        position1.setFarbe(docPosition1.get("farbe").toString());
        position1.setAnzahl(docPosition1.getInteger("menge"));
        position1.setEinheit(docPosition1.get("einheit").toString());
        position1.setPreis(docPosition1.getDouble("einzelpreis"));

        Product position2 = new Product();
        Document docPosition2 = price2;
        position2.setArtikelNr(docPosition2.getInteger("artikelNr"));
        position2.setBezeichung(docPosition2.get("bezeichnung").toString());
        position2.setFarbe(docPosition2.get("farbe").toString());
        position2.setAnzahl(docPosition2.getInteger("menge"));
        position2.setEinheit(docPosition2.get("einheit").toString());
        position2.setPreis(docPosition2.getDouble("einzelpreis"));

        Product position3 = new Product();
        Document docPosition3 = price3;
        position3.setArtikelNr(docPosition3.getInteger("artikelNr"));
        position3.setBezeichung(docPosition3.get("bezeichnung").toString());
        position3.setFarbe(docPosition3.get("farbe").toString());
        position3.setAnzahl(docPosition3.getInteger("menge"));
        position3.setEinheit(docPosition3.get("einheit").toString());
        position3.setPreis(docPosition3.getDouble("einzelpreis"));

        Product position4 = new Product();
        Document docPosition4 = price4;
        position4.setArtikelNr(docPosition4.getInteger("artikelNr"));
        position4.setBezeichung(docPosition4.get("bezeichnung").toString());
        position4.setFarbe(docPosition4.get("farbe").toString());
        position4.setAnzahl(docPosition4.getInteger("menge"));
        position4.setEinheit(docPosition4.get("einheit").toString());
        position4.setPreis(docPosition4.getDouble("einzelpreis"));

        ArrayList<Product> products = new ArrayList<>();
        products.add(position0);
        products.add(position1);
        products.add(position2);
        products.add(position3);
        products.add(position4);

        bill.setPositionen(products);
        
        
        return bill;
    }
}
                
           </pre>
            
            
        </div>
        
        <h3>package ch.teko.grossmac.db4.a4 (DeleteBill)</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
            <pre>
                
                package ch.teko.grossmac.db4.a4;

import ch.teko.grossmac.db4.a4.dao.BillDao;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.bson.Document;

/**
 *DeleteBill empfängt einen Parameter einer Rechnungsnummer um diese in der Datenbank zu suchen und löschen.
 * @author ch.grossmann
 */
public class DeleteBill extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        
        /**
         * erhaltener Parameter billNr
         */
        int billNr = Integer.parseInt(request.getParameter("billNr"));

        BillDao billDao = new BillDao();
        
        /**
         * Übergabe an die Methode deleteBillNr um im BillDao die Verbindung zur Db herzustellen.
         */
        Document delBill = billDao.deleteBillNr(billNr);

        request.setAttribute("DeleteBill", delBill);
        request.getRequestDispatcher("deleteBill.jsp").forward(request, response);

    }

}
                
                
           </pre>
            
            
        </div>
        
       
        
        
        <h3>Beschreibung der Lösung aus Anwendersicht</h3>
        <div style="min-height: 100px; max-width: 1000px; border-style: solid; border-width: 1pt">
            
<pre>

    Auf der Startseite kann dirket die Erste Rechnung erfasst werden. Es sollten alle Felder 
    ausgefüllt werden, da sonst ein Fehler auftritt. Im vorfeld sind alle Felder bereits mit einem Wert belegt.
    Dies war nicht ganz in meinem Sinne da placeholder eingrichtet sind um die Eingabemske etwas
    einfacher verständlich zu machen. Die erfasste Rechung wird direkt in der Rechnungsansicht dargestellt.
    Es stehen folgende Aktionen zur verfügung: Erfassen - Dies speichert die eingegebenen Werte in die Datenbank 
    als Rechnung. -- Rechnungen auflisten - Liest alle Rechnungen aus der Datenbank und Listet sie in abgespeckter Form auf. 
    Es werden nur die Atribute Rechnungsnummer und Kunde(Firmenname) dargestellt.
    -- Rechnung anzeigen - Durch die Aingabe einer Rechnungsnummer wird diese in der Rechungsansicht dargestellt. 
    -- Rechnung ändern - Durch die Eingabe einer Rechnungsnummer wird diese in der Eingabemaske dargestellt und kann angepasst 
    werden. Mit den Button ändern wird diese gespeichert und in der Rechnungsansicht dargestellt.
    -- Rechnung löschen - Durch die Eingabe einer Rechnungsnummer wird diese gelöscht und es wird die Anzahl gelöschter 
    Datensätze angezeigt.

    Bekannte Fehler:
    - Durch die Eingabe einer nicht vorhandenen Rechnungsnummer entsteht ein Fehler.
    - Nicht ausgefüllte Positionen in der Eingabemaske ergeben einen Fehler.
    - Es können mehrere Rechnungen mit der selben Rechungsnummer erstellt werden, wenn dies geschieht kann nicht gewählt 
    werden welche angezeigt wird beim Suchen.

    Diese Art Arbeit ist sehr lehrreich. Der Unterricht sollte dem Verlauf der Arbeit angepasst werden und nach und nach 
    weiter benötigte Elemente erarbeitet werden.
    trotz der zur Verfügung gestellten Zeit wärend dem Unterricht ist dies sehr Zeitaufwendig. Ich musste in den Sommerferien 
    nochmals anfangen da die vorherige Version zu kompliziert war.
    Die meisten von uns in der Klasse haben keinerlei vorerfahrung im entwerfen von einer Software oder Website. 
    Diese Elemente sind erst später Teil des Unterrichts.

    Danke für diese Aufgabe ich habe dadurch mehr gelernt als in so mancher anderer Unterrichtsstunde.


</pre>
            
        </div>
        
        
        
        <h3>Link zum Code oder der lauffähigen Web-Site</h3>
        <a href="/Aufgabe4_Rechnungen">Aufgabe 4</a>
        <br><br>




    </body>

</html>
